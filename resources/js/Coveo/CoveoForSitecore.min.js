var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},CoveoForSitecore;!function(e){var t=function(t){function o(i,n,s){t.call(this,i,o.ID,s),this.element=i,this.options=n,this.omniboxResultListHandler=new e.OmniboxResultListHandler,this.options=Coveo.ComponentOptions.initComponentOptions(i,o,n),s&&this.initializeOmniboxDataRowIndex(s),this.bind.onRootElement(Coveo.OmniboxEvents.populateOmnibox,this.populateOmnibox)}return __extends(o,t),o.prototype.populateOmnibox=function(e){this.omniboxResultListHandler.populateOmniboxResultList(e,this.options,this.queryController)},o.prototype.initializeOmniboxDataRowIndex=function(e){var t=document.getElementsByClassName("CoveoForSitecoreOmniboxResultList")[0];e.searchInterface.options.originalOptionsObject.keepOmniboxSuggestionsProvidersDefaultOrdering||(this.options.omniboxDataRowIndex=51+Coveo.$$(t).children().length-e.searchInterface.options.originalOptionsObject.omniboxDataRowIndexCounter,e.searchInterface.options.originalOptionsObject.omniboxDataRowIndexCounter++)},o.ID="ForSitecoreOmniboxResultList",o.options={headerTitle:Coveo.ComponentOptions.buildStringOption(),queryExpression:Coveo.ComponentOptions.buildStringOption(),numberOfResults:Coveo.ComponentOptions.buildNumberOption({defaultValue:10,min:1}),omniboxDataRowIndex:Coveo.ComponentOptions.buildNumberOption({defaultValue:51,min:16}),resultTemplateId:Coveo.ComponentOptions.buildStringOption()},o}(Coveo.Component);e.OmniboxResultList=t}(CoveoForSitecore||(CoveoForSitecore={})),Coveo.Initialization.registerAutoCreateComponent(CoveoForSitecore.OmniboxResultList);var CoveoForSitecore;!function(e){var t=function(){function e(){}return e.getOmniboxDataRowIndex=function(){return this.omniboxDataRowIndexCounter=this.omniboxDataRowIndexCounter+1,this.omniboxDataRowIndexCounter},e.prototype.onOmniboxRowClicked=function(e){window.location.href=e.clickUri},e.prototype.buildOmniboxContent=function(e,t){var o=this,i=t.id?t.id:t.resultTemplateId,n=document.getElementById(i),s=new Coveo.UnderscoreTemplate(n),r=this.getResultContainer(t.headerTitle),a=Coveo.$$("div");return a.append(r.el),_.each(e,function(e){var t=s.instantiateToElement(e),i=Coveo.$$(t);i.addClass("CoveoResult coveo-omnibox-selectable"),i.on("click keyboardSelect",function(){o.onOmniboxRowClicked(e)}),a.append(t)}),a.el},e.prototype.getResultContainer=function(e){var t=Coveo.$$("div");return t.addClass("coveo-omnibox-result-list-header"),t.append(this.getIcon().el),t.append(this.getCaption(e).el),t},e.prototype.getIcon=function(){var e=Coveo.$$("span");return e.addClass("coveo-icon-omnibox-result-list"),e},e.prototype.getCaption=function(e){var t=Coveo.$$("span");return t.addClass("coveo-caption"),t.el.textContent=e,t},e.prototype.populateOmniboxResultList=function(e,t,o){var i=this,n=o.createQueryBuilder(t);t.queryExpression&&"string"==typeof t.queryExpression&&n.advancedExpression.add(t.queryExpression),n.numberOfResults=t.numberOfResults;var s=n.build(),r=Coveo.SearchEndpoint.endpoints["default"].search(s).then(function(e){if(e.totalCount>0){var o=i.buildOmniboxContent(e.results,t),n={zIndex:t.omniboxDataRowIndex,element:o};return n}return{element:void 0}});e.rows.push({deferred:r})},e.omniboxDataRowIndexCounter=0,e}();e.OmniboxResultListHandler=t}(CoveoForSitecore||(CoveoForSitecore={}));var CoveoForSitecore;!function(e){var t=function(){function e(){}return e.prototype.getFilterExpressions=function(e){var t="",o=new Array;if(e.filterResultsOnCurrentCulture){var i=this.getFilterExpression(e.clientLanguageFieldName,e.clientLanguageName);o.push(i)}if(e.filterResultOnLatestVersion){var i=this.getFilterExpression(e.latestVersionFieldName,"1");o.push(i)}if(o.length>0){t="(";for(var n=0;n<o.length;n++)t+=o[n]+" ";t=t.replace(/^\s+|\s+$/g,""),t+=")"}return this.hasExternalContentSpecified(e)&&(t=this.appendExternalContentToExpression(t,e)),t},e.prototype.getFilterExpression=function(e,t){var o=e+'=="'+t+'"';return o},e.prototype.getSearchExpression=function(e){var t=this.getSourcesAndCollectionsExpression(e);return t+=" "+e.filterExpression,t+=" "+e.boostExpressions},e.prototype.getSourcesAndCollectionsExpression=function(e){var t,o=this.getSourcesExpression(e);if(e.externalCollections.length>0){var i=this.getExternalCollectionsExpression(e);t="("+o+" OR "+i+")"}else t=o;return t},e.prototype.getSourcesExpression=function(e){var t=this.isDefined(e.indexSourceName)?'"'+e.indexSourceName+'"':"";return e.externalSources.length>0&&(this.isDefined(e.indexSourceName)&&(t+=","),t+='"'+e.externalSources.join('","')+'"'),"@syssource==("+t+")"},e.prototype.getExternalCollectionsExpression=function(e){return'@syscollection==("'+e.externalCollections.join('","')+'")'},e.prototype.appendExternalContentToExpression=function(e,t){if(this.hasExternalContentSpecified(t)){if(e="("+e,t.externalSources.length>0){var o=' OR @syssource==("';o+=t.externalSources.join('","'),o+='")',e+=o}if(t.externalCollections.length>0){var i=this.getExternalCollectionsExpression(t);e+=" OR "+i}e+=")"}return e},e.prototype.isDefined=function(e){return"undefined"!=typeof e},e.prototype.hasExternalContentSpecified=function(e){return e.externalCollections.length>0||e.externalSources.length>0},e}();e.ExpressionsHelper=t}(CoveoForSitecore||(CoveoForSitecore={}));var CoveoForSitecore;!function(e){var t=function(){function e(){this.bindings={},this.excludeFromTabTag="tabNot"}return e.prototype.excludeItemsIdsInTab=function(e,t){var o=this;e.map(this.initBinding,this).forEach(function(e){o.addBinding(e,o.excludeFromTabTag,t)})},e.prototype.applyBindings=function(){var e=this;Object.keys(this.bindings).forEach(function(t){var o=e.bindings[t],i=document.getElementById(t),n=Coveo.$$(i);n&&o[e.excludeFromTabTag]&&n.setAttribute("data-tab-not",o.tabNot.join(","))})},e.prototype.initBinding=function(e){return this.bindings.hasOwnProperty(e)||(this.bindings[e]={}),this.bindings[e]},e.prototype.addBinding=function(e,t,o){e.hasOwnProperty(t)||(e[t]=[]),e[t].push(o)},e}();e.TabsBinding=t}(CoveoForSitecore||(CoveoForSitecore={}));var CoveoForSitecore;!function(e){function t(t,o){e.tabsBinding.applyBindings(),i(t)||(e.plugin=new e.CoveoForSitecoreBase(t,o),e.plugin.initialize())}function o(t,o){e.plugin=new e.Searchbox(t,o),e.plugin.initialize()}function i(t){return e.plugin&&e.plugin.element&&e.plugin.element[0].id===t[0].id}e.initializeSearch=t,e.initializeSearchbox=o}(CoveoForSitecore||(CoveoForSitecore={}));var Coveo;!function(e){function t(e,t,o){"init"===t?CoveoForSitecore.initializeSearch(e,o):"initSearchbox"===t?CoveoForSitecore.initializeSearchbox(e,o):console.error("The action '"+t+"' is not part of the coveoForSitecore plugin. Ignoring action.")}function o(e){this.$=e,this.initializeCoveoForSitecorePlugin()}function i(){"undefined"!=typeof this.$&&"undefined"!=typeof this.$.fn&&(e.$.fn.coveoForSitecore=function(t,o){return e.initCoveoForSitecore(this[0],t,o),this})}e.initCoveoForSitecore=t,e.initializeJQuery=o,e.initializeCoveoForSitecorePlugin=i}(Coveo||(Coveo={})),function(e){"undefined"!=typeof e&&Coveo.initializeJQuery(e)}(jQuery);var CoveoForSitecore;!function(e){var t=function(){function t(t,o){this.isInPageEditorCssClass="coveo-page-editor",this.isEditingInPageEditorCssClass="coveo-page-editor-editing",this.isPreviewingInPageEditorCssClass="coveo-page-editor-previewing",this.isPreviewingInPageEditorWithSimulatedDeviceCssClass="coveo-page-editor-previewing-with-simulator",this.element=t,this.domElement=Coveo.$$(t),this.options=_.extend({},e.defaults,o),this.logger=new e.Logger(this.options.enableClientSideLogging),this.expressionsHelper=new e.ExpressionsHelper,this.omniboxResultListHandler=new e.OmniboxResultListHandler,this.endpointCaller=new Coveo.EndpointCaller}return t.prototype.initialize=function(){var e=this;if(this.logger.log("Initializing search."),this.initializeSearchOptions(),!this.options.isInitialized){this.addPageEditorCssClasses(),this.addResultListHeaderCssClasses(),this.domElement.on(Coveo.InitializationEvents.afterInitialization,function(){Coveo.HashUtils.getValue("sort",window.location.hash)||Coveo.state(e.element,"sort",e.options.defaultSortCriteriaLowercase)});var t=this.expressionsHelper.getSearchExpression(this.options),o=Coveo.Utils.extendDeep({Facet:{},SearchInterface:{expression:t}},this.options);Coveo.init(this.element,o)}this.doPostInitializationActions()},t.prototype.doPostInitializationActions=function(){var e=this;_.forEach(this.domElement.findAll(".CoveoQuerybox input, .CoveoOmnibox input"),function(t){t.setAttribute("placeholder",e.options.searchboxPlaceholderText)})},t.prototype.initializeSearchOptions=function(){var t=this;e.SearchEndpointHelper.initializeEndpoint(this.options),this.options.enableClientSideLogging&&Coveo.Logger.enable(),this.options.isInitialized||(this.addPageEditorCssClasses(),this.domElement.on(Coveo.QueryEvents.buildingQuery,function(e,o){t.addSortCriteriaToQuery(o.queryBuilder)}),this.domElement.on(Coveo.InitializationEvents.afterInitialization,function(){t.registerSearchEvents(),t.options.isInitialized=!0}),this.options.sendToSitecoreAnalytics&&(window.onbeforeunload=function(){Coveo.Defer.flush()},this.domElement.on(Coveo.AnalyticsEvents.searchEvent,function(e,o){t.postAnalytics("searches","searchEvents",o.searchEvents)}),this.domElement.on(Coveo.AnalyticsEvents.documentViewEvent,function(e,o){t.postAnalytics("documentViews","documentViewEvents",o.documentViewEvent)}),this.domElement.on(Coveo.AnalyticsEvents.customEvent,function(e,o){t.postAnalytics("custom","customEvents",o.customEvent)})))},t.prototype.postAnalytics=function(t,o,i){var n=this;i=[].concat(i),i.forEach(function(e){e.sitecoreItemId=n.options.sitecoreItemId});var s={};s[o]=JSON.stringify(i),this.sendPostRequest(e.Utilities.appendTrailingSlash(this.options.analyticsEndpointUri)+t,s)},t.prototype.addPageEditorCssClasses=function(){this.isInPageEditor()&&(this.domElement.addClass(this.isInPageEditorCssClass),this.options.isEditingInPageEditor&&this.domElement.addClass(this.isEditingInPageEditorCssClass),this.options.isPreviewingInPageEditor&&this.domElement.addClass(this.isPreviewingInPageEditorCssClass),this.options.isPreviewingInPageEditorWithSimulatedDevice&&this.domElement.addClass(this.isPreviewingInPageEditorWithSimulatedDeviceCssClass))},t.prototype.addResultListHeaderCssClasses=function(){var e=this.getDomElementsMatchingSelector(".coveo-results-header, .coveo-result-header-section");_.filter(e,function(e){return"undefined"!=typeof e&&!e.hasClass("CoveoQuerySummary")&&e.hasClass("CoveoQueryDuration")&&e.hasClass("CoveoSort")}).forEach(function(e){e.addClass("coveo-empty")})},t.prototype.getFilterExpressions=function(){return this.expressionsHelper.getFilterExpressions(this.options)},t.prototype.registerSearchEvents=function(){var e=this;this.logger.log("Registering search events."),this.domElement.on(Coveo.QueryEvents.buildingQuery,function(t,o){o.queryBuilder.constantExpression.add(e.expressionsHelper.getFilterExpressions(e.options))}),this.domElement.on(Coveo.AnalyticsEvents.changeAnalyticsCustomData,function(t,o){var i=e.options;i&&(i.clientLanguageName&&(o.language=i.clientLanguageName),i.pageName&&(o.originLevel1=i.pageName),i.pageFullPath&&(o.originLevel3=i.pageFullPath),i.analyticsCustomMetadata&&(o.metaObject=_.extend({},o.metaObject,i.analyticsCustomMetadata)))}),this.options.componentRefreshCallback&&(this.domElement.on(Coveo.QueryEvents.deferredQuerySuccess,function(){e.options.componentRefreshCallback()}),this.domElement.on(Coveo.QueryEvents.queryError,function(){e.options.componentRefreshCallback()}))},t.prototype.addSortCriteriaToQuery=function(e){e.sortCriteria=this.options.defaultSortCriteriaNoSpace,"Field"===this.options.defaultSortType&&(e.sortField=this.options.defaultSortField)},t.prototype.isInPageEditor=function(){return this.options.isEditingInPageEditor||this.options.isPreviewingInPageEditor||this.options.isPreviewingInPageEditorWithSimulatedDevice},t.prototype.configureOmnibox=function(e){this.domElement.on(Coveo.OmniboxEvents.populateOmnibox,this.generatePopulateOmniboxFunction(e))},t.prototype.generatePopulateOmniboxFunction=function(e){var t=this,o=Coveo.get(this.element).queryController;return function(i,n){t.omniboxResultListHandler.populateOmniboxResultList(n,e,o)}},t.prototype.getDomElementsMatchingSelector=function(e){return _.map(document.querySelectorAll(e),function(e){return Coveo.$$(e)})},t.prototype.sendPostRequest=function(e,t){var o={errorsAsSuccess:!1,method:"POST",queryString:[],requestData:t,url:e,responseType:"text",requestDataType:"application/json"};this.endpointCaller.call(o)},t}();e.CoveoForSitecoreBase=t}(CoveoForSitecore||(CoveoForSitecore={}));var CoveoForSitecore;!function(e){e.tabsBinding=new e.TabsBinding}(CoveoForSitecore||(CoveoForSitecore={}));var CoveoForSitecore;!function(e){var t=function(){function e(e){this.enableClientSideLogging=e}return e.prototype.log=function(e){this.enableClientSideLogging&&console.log(["TRACE","Coveo for Sitecore"].concat(e))},e}();e.Logger=t}(CoveoForSitecore||(CoveoForSitecore={}));var CoveoForSitecore;!function(e){var t=function(){function e(){this.analyticsCustomMetadata={},this.analyticsEndpointUri="/coveo/rest/v6/analytics/",this.boostExpressions="",this.clientLanguageFieldName="",this.clientLanguageName="",this.componentRefreshCallback=null,this.defaultSortType="Relevancy",this.defaultSortField="",this.defaultSortCriteriaNoSpace="Relevancy",this.defaultSortCriteriaLowercase="relevancy",this.enableClientSideLogging=!1,this.externalCollections=new Array,this.externalSources=new Array,this.filterExpression="",this.filterResultOnLatestVersion=!0,this.filterResultsOnCurrentCulture=!1,this.indexSourceName="",this.isEditingInPageEditor=!1,this.isInitialized=!1,this.isPreviewingInPageEditor=!1,this.isPreviewingInPageEditorWithSimulatedDevice=!1,this.keepOmniboxSuggestionsProvidersDefaultOrdering=!0,this.latestVersionFieldName="",this.omniboxDataRowIndexCounter=0,this.pageFullPath="",this.pageName="",this.restEndpointUri="/coveo/rest/",this.resultListInfiniteScrollContainer=window,this.searchboxPlaceholderText="",this.searchRedirectionUrl="",this.sendToSitecoreAnalytics=!1,this.sitecoreItemId="",this.sitecoreItemUri="",this.siteName=""}return e}();e.PluginOptions=t,e.defaults=new t}(CoveoForSitecore||(CoveoForSitecore={}));var CoveoForSitecore;!function(e){var t=function(e){function t(t,o){e.call(this,t,o)}return __extends(t,e),t.prototype.initialize=function(){var e=this;this.logger.log("Initializing searchbox."),this.initializeSearchOptions(),this.options.isInitialized||this.domElement.on(Coveo.QueryEvents.buildingQuery,function(t,o){var i=e.expressionsHelper.getSearchExpression(e.options);o.queryBuilder.advancedExpression.add(i)}),Coveo.initSearchbox(this.element,this.options.searchRedirectionUrl,this.options),this.doPostInitializationActions()},t}(e.CoveoForSitecoreBase);e.Searchbox=t}(CoveoForSitecore||(CoveoForSitecore={}));var CoveoForSitecore;!function(e){var t=function(){function e(){}return e.initializeEndpoint=function(e){Coveo.SearchEndpoint.endpoints["default"]=new Coveo.SearchEndpoint({restUri:e.restEndpointUri,queryStringArguments:{sitecoreItemUri:e.sitecoreItemUri,siteName:e.siteName}})},e}();e.SearchEndpointHelper=t}(CoveoForSitecore||(CoveoForSitecore={}));var CoveoForSitecore;!function(e){var t=function(){function e(){}return e.appendTrailingSlash=function(e){return"/"===e.charAt(e.length-1)?e:e+"/"},e}();e.Utilities=t}(CoveoForSitecore||(CoveoForSitecore={}));var Coveo;!function(e){var t;!function(e){function t(){return o}var o=/^file:\/\/\/.*_asset/i.test(document.URL)||/^file:\/\/\/.*var\/mobile/i.test(document.URL)||/^file:\/\/\/.*\/CoreSimulator/.test(document.URL);e.isPhonegap=t}(t=e.DeviceUtils||(e.DeviceUtils={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){function o(e){u.addClass("active"),setTimeout(function(){u.removeClass("active")},e)}function i(e,t){e.addClass("coveo-clicked"),setTimeout(function(){e.removeClass("coveo-clicked")},t)}function n(o,i){void 0===i&&(i=!1);var n="."+e.Component.computeCssClassNameForType(e.SearchInterface.ID);e.$(n+",.coveo-glass").addClass("coveo-"+o),e.$(".coveo-glass").addClass("coveo-active-glass"),i&&"Android"==e.DeviceUtils.getDeviceName()&&e.$(document).on("backbutton",e.$.proxy(t.removeToggleClassOnSearchInterface,this,!0))}function s(t){void 0===t&&(t=!1);var o="."+e.Component.computeCssClassNameForType(e.SearchInterface.ID);e.$(o+",.coveo-glass").removeClass("coveo-slide-right").removeClass("coveo-slide-left").removeClass("coveo-active-glass").removeClass("coveo-active-glass-for-current-tab"),e.$(".coveo-tab-section").removeClass("coveo-opened-by-current-tab");var i=e.Component.getComponentRef("CurrentTab");if(i){var n="."+e.Component.computeCssClassNameForType(i.ID);e.$(n).removeClass("coveo-opening-tab-section")}t&&"Android"==e.DeviceUtils.getDeviceName()&&e.$(document).off("backbutton")}function r(){e.$("."+e.Component.computeCssClassNameForType(e.SearchInterface.ID)).append(u)}function a(t){e.$(window).focus(),e.$(t).blur()}function l(){e.DeviceUtils.isIos()&&e.$(window).on("touchstart",function(o){!e.$(o.target).is("input")&&e.$(document.activeElement).is("input")&&t.hideIOSKeyboard(document.activeElement)})}function c(){e.DeviceUtils.isMobileDevice()&&(e.$(function(){return r()}),l())}var u=e.$(document.createElement("div")).addClass("coveo-click-canceling-overlay");t.showClickCancelingOverlay=o,t.showClickFeedback=i,t.addToggleClassOnSearchInterface=n,t.removeToggleClassOnSearchInterface=s,t.hideIOSKeyboard=a,c()}(t=e.MobileUtils||(e.MobileUtils={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var o=function(t){function o(i,n,s){var r=this;t.call(this,i,o.ID,s),this.element=i,this.options=n,this.options=e.ComponentOptions.initComponentOptions(i,o,n),e.Assert.exists(i),e.Assert.exists(this.options),this.classToToggle=this.options.toggleClass,this.target=this.options.target,this.activateGlass=this.options.activateGlass,this.activateGlass&&this.buildGlass(),e.$(i).click(function(){return r.handleClick()}),"A"==i.tagName&&e.$(i).attr("href","javascript:");var a=this.queryStateModel.getEventName(e.Model.eventTypes.changeOne+e.QueryStateModel.attributesEnum.t);this.bind.onRootElement(a,this.handleTabChanged)}return __extends(o,t),o.prototype.handleClick=function(){e.$("."+this.target).hasClass(this.classToToggle)?this.removeToggleClass():this.addToggleClass()},o.prototype.handleTabChanged=function(){this.removeToggleClass()},o.prototype.addToggleClass=function(){e.MobileUtils.addToggleClassOnSearchInterface(this.classToToggle.substr(6),e.DeviceUtils.isPhonegap())},o.prototype.removeToggleClass=function(){e.MobileUtils.removeToggleClassOnSearchInterface(e.DeviceUtils.isPhonegap())},o.prototype.getGlass=function(){return e.$(".coveo-glass")},o.prototype.buildGlass=function(){if(0==this.getGlass().length){var t=e.$("<div></div>").addClass("coveo-glass");t.click(function(){e.MobileUtils.removeToggleClassOnSearchInterface()});var o=e.$("."+e.Component.computeCssClassNameForType(e.SearchInterface.ID));e.$(o).append(t)}},o.ID="ToggleButton",o.options={toggleClass:e.ComponentOptions.buildStringOption(),target:e.ComponentOptions.buildStringOption(),activateGlass:e.ComponentOptions.buildBooleanOption({defaultValue:!0})},o}(e.Component);t.ToggleButton=o,e.Initialization.registerAutoCreateComponent(o)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));